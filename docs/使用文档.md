# 使用文档

本文档用于记录本仓库二次开发/新增功能的使用方式与关键技术点，作为单一入口文档。新功能请在本文档末尾追加条目（按时间顺序追加）。

## 运行与登录

项目运行环境、启动方式、默认账号等请参考：[README.md](../README.md)。

## 功能目录

| 模块 | 功能 | 条目标题 |
| --- | --- | --- |
| 收银 | 开台弹出收银台页面 | 见文末“功能条目” |

## 功能条目

以下条目按新增时间顺序追加。

### 收银｜开台弹出收银台页面

**目标**：在“前台收银”中点击座席“开台”后，自动弹出全屏收银台弹窗，支持点项目/点产品、改数量/删行、结算清台并回到房台。

**入口**

- 菜单：收银 → 前台收银
- 页面：`/cashier/index`

**使用流程**

- 选择门店（页面顶部“门店”下拉）
- 点击某个座席（如“测试座席A1”），系统自动开台并弹出收银台弹窗
- 在弹窗中：
  - 项目列表：点击项目卡片，加入服务明细
  - 产品列表：点击产品卡片，加入商品购物车
  - 左侧清单：可调整数量、删除条目
  - 点击“结算”：完成结算并自动清台，关闭弹窗并刷新座席状态
  - 点击“返回房台”：关闭弹窗但不清台（会话仍在）

**关键接口**

- 开台：`POST /cashier/session/open`
- 会话详情（刷新弹窗左侧清单与合计）：`GET /cashier/session/detail?sessionId={id}`  
  - 代码：[CashierSessionController](../jshERP-boot/src/main/java/com/jsh/erp/controller/CashierSessionController.java)、[CashierSessionService](../jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierSessionService.java)
- 项目列表（服务项目字典）：`GET /cashier/serviceItem/list?currentPage=1&pageSize=200&search={...}`  
  - 代码：[ServiceItemController](../jshERP-boot/src/main/java/com/jsh/erp/controller/ServiceItemController.java)
- 点项目（快速加入服务明细）：`POST /cashier/serviceOrder/quickAddItem`  
  - 改数量：`PUT /cashier/serviceOrder/item/updateQty`  
  - 删除行：`POST /cashier/serviceOrder/item/delete`  
  - 代码：[ServiceOrderController](../jshERP-boot/src/main/java/com/jsh/erp/controller/ServiceOrderController.java)、[ServiceOrderService](../jshERP-boot/src/main/java/com/jsh/erp/service/cashier/ServiceOrderService.java)
- 点产品（加入会话购物车）：`POST /cashier/cart/product/add`  
  - 改数量：`PUT /cashier/cart/product/updateQty`  
  - 删除行：`POST /cashier/cart/product/delete`  
  - 代码：[CashierCartController](../jshERP-boot/src/main/java/com/jsh/erp/controller/CashierCartController.java)、[CashierCartService](../jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierCartService.java)
- 结算清台：`POST /cashier/settlement/checkout`（`clearSeat=true` 时清台）  
  - 代码：[CashierSettlementController](../jshERP-boot/src/main/java/com/jsh/erp/controller/CashierSettlementController.java)、[CashierSettlementService](../jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierSettlementService.java)

**数据与表结构**

- 服务项目内容来源：表 `jsh_service_item`  
  - 建表定义：[jsh_erp.sql](../jshERP-boot/docs/jsh_erp.sql)  
  - 说明：收银台“项目列表”按 `enabled`、`delete_flag`、`tenant_id` 过滤并按 `sort` 排序（SQL：[ServiceItemMapper.xml](../jshERP-boot/src/main/resources/mapper_xml/ServiceItemMapper.xml)）
- 会话商品购物车明细：表 `jsh_cashier_session_product_item`  
  - 建表/升级脚本：[jsh_erp.sql](../jshERP-boot/docs/jsh_erp.sql)、[upgrade_cashier_session_product_item.sql](../jshERP-boot/docs/upgrade_cashier_session_product_item.sql)

**注意事项**

- “返回房台”仅关闭弹窗，不会清台；需通过“结算”完成清台。
- 服务项目维护入口：收银 → 服务项目管理。

### 收银｜服务项目管理

**目标**：维护收银台“项目列表”中的服务项目，支持新增/编辑/启用禁用/删除。

**入口**

- 菜单：收银 → 服务项目管理
- 页面：`/cashier/service_item`

**使用流程**

- 打开“服务项目管理”
- 点击“新增”，填写名称、单价、时长(分钟)、排序、状态后保存
- 新增后回到“前台收银”的“项目列表”，点击刷新即可看到新增项目

**关键接口**

- 列表：`GET /cashier/serviceItem/list`
- 新增：`POST /cashier/serviceItem/add`
- 编辑：`PUT /cashier/serviceItem/update`
- 删除：`DELETE /cashier/serviceItem/delete`
- 批量删除：`DELETE /cashier/serviceItem/deleteBatch`

**数据与表结构**

- 数据表：`jsh_service_item`
- 关键字段：`name`（名称）、`price`（单价）、`duration_min`（时长分钟）、`enabled`（启用）、`sort`（排序）、`tenant_id`（租户隔离）、`delete_flag`（逻辑删除）

**权限/租户影响**

- 菜单权限：依赖 `jsh_function` 与 `jsh_user_business(RoleFunctions)` 配置。
- 租户隔离：列表按 `tenant_id` 过滤，新增时会写入当前租户的 `tenant_id`。

## 新增功能条目模板

新功能请复制以下模板，并追加到本文档末尾。

### {模块}｜{功能标题}

**目标**：{一句话说明要解决什么问题/带来什么能力}

**入口**

- 菜单：{模块} → {菜单项}
- 页面：`{路由}`（如有）

**使用流程**

- {步骤 1}
- {步骤 2}
- {步骤 3}

**关键接口**

- `{METHOD} {PATH}`：{用途说明}
- `{METHOD} {PATH}`：{用途说明}

**数据与表结构**

- {表名}：{新增/变更说明}
- {字段}：{含义/约束/默认值}

**权限/租户影响**

- 权限点：{如有}
- 租户隔离：{是否按 tenant_id 过滤/写入}

**注意事项**

- {边界条件/常见问题}
