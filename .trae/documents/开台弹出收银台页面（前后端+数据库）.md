## 目标
- 点击空闲座席“开台”后，弹出与截图一致的“收银台”全屏弹窗（包含：主单信息/会员/项目列表/产品列表/结算）。
- 打通后端接口与数据库存储：本台服务项目明细、本台商品明细、结算关台。

## 前端（jshERP-web）
- 在现有 [Cashier.vue](file:///Users/lv/Workspace/erp/jshERP-web/src/views/cashier/Cashier.vue) 的 `handleSeatClick` 中：
  - 开台成功（`cashierOpenSession` 返回 200）后不只 toast，而是打开一个全屏 Modal（保持当前路由不变，满足“弹出页面”）。
  - Modal 关闭=“返回房台”（不清台）；结算成功可选择“结算并清台”。
- 新增弹窗组件（建议路径）：`src/views/cashier/modules/CashierDeskModal.vue`
  - 顶部 Tab：主单信息 / 会员刷卡 / 项目列表 / 产品列表 / 结算（“微信预约”先放占位入口，不阻塞主流程）。
  - 左侧：本台消费清单（服务+商品），支持数量调整、删除行、显示小计/合计。
  - 右侧：
    - 项目列表：调用 `/cashier/serviceItem/list`（支持分类与关键词；分类先用“全部/启用”实现，后续可加项目分类表）。
    - 产品列表：复用现有“商品(material)”查询接口（按分类+关键词），点击卡片加入本台购物车。
  - 结算页：展示预结算金额、选择支付方式（现金/扫码/签单），点击“结算”调用后端结算接口。
- 扩展前端 API 封装（[api.js](file:///Users/lv/Workspace/erp/jshERP-web/src/api/api.js)）：新增 session detail、购物车、结算相关函数。

## 后端（jshERP-boot）
- 新增/补齐会话汇总接口（减少前端多次请求）：
  - `GET /cashier/session/detail?sessionId=...`：返回 session、seat、member、服务单+明细、商品购物车明细、合计金额。
- 补齐服务明细的编辑能力（满足左侧清单可改可删）：
  - `PUT /cashier/serviceOrder/item/updateQty`
  - `DELETE /cashier/serviceOrder/item/delete`
  - 必要时增加“按 session 聚合明细”辅助接口。
- 新增“本台商品购物车”接口（与 sessionId 绑定）：
  - `POST /cashier/cart/product/add`
  - `PUT /cashier/cart/product/updateQty`
  - `DELETE /cashier/cart/product/delete`
  - `GET /cashier/cart/product/listBySession?sessionId=...`
- 新增结算编排接口：
  - `GET /cashier/settlement/preview?sessionId=...`（应收/已点明细/合计）
  - `POST /cashier/settlement/checkout`：
    - 服务：对未完成服务单按策略完成并固化提成；
    - 商品：将购物车落单到 `depotHead/depotItem`（零售出库）或保持草稿后审核；
    - 收款：按支付方式生成 `accountHead/accountItem`（或签单写 `credit_bill`）；
    - 最后：关闭 session + 释放 seat。

## 数据库（docs/jsh_erp.sql + 升级脚本）
- 新增购物车表（建议）：`jsh_cashier_session_product_item`
  - 字段：`id, session_id, material_id, material_name_snap, unit_price, qty, amount, tenant_id, delete_flag, create_time`。
  - 索引：`idx_session(session_id)`, `idx_tenant(tenant_id)`。
- 若要支持“项目分类/项目分类下拉”：新增 `jsh_service_item_category` + `service_item.category_id`（先按你的截图 UI 需要程度决定，可先不做分类表，用关键词+排序实现）。
- 统一遵循租户插件：所有 insert XML 不手写 `tenant_id`，避免重复注入。

## 联调与验收（我会在实现后做）
- 前端：点击空闲座席→开台→弹出收银台；返回房台不清台；清台仍走原 confirm。
- 项目列表：可加载、可加入清单、可改数量/删除。
- 产品列表：可搜索、可加入购物车、可改数量/删除。
- 结算：预结算金额正确；结算成功后自动清台并刷新座席状态。
- 后端：新增接口均覆盖 tenantId、delete_flag 规则；异常可追溯日志完整。

## 交付物
- 新增前端全屏弹窗组件 + API 封装 + Cashier.vue 接入。
- 新增后端 Controller/Service/Mapper/MapperXML + 数据表 DDL（含 docs 更新）。
- 端到端联调通过（以浏览器实际操作与接口返回为准）。