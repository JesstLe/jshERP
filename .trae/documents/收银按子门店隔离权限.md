你这个反馈非常关键：**菜单可见 ≠ 数据可越权**。现在收银页“门店下拉”本身是走“按当前用户过滤”的接口，但后端收银链路里确实存在多处“只要传 depotId/sessionId/orderId 就能越权读取/操作”的风险点，需要补齐“门店维度的强校验”。

## 现状与原因
- 收银门店列表前端调用 `GET /depot/findDepotByCurrentUser`（[Cashier.vue](file:///Users/lv/Workspace/erp/jshERP-web/src/views/cashier/Cashier.vue#L241-L251)）。
- 后端该接口会按 `UserBusiness(type='UserDepot')` 过滤门店（且受 `systemConfig.depotFlag` 开关影响）：[DepotController.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/controller/DepotController.java#L206-L220)、[DepotService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/DepotService.java#L315-L354)。
- 但是：收银相关很多接口没有把“门店权限”作为强制条件，只校验 tenant 或者干脆不校验，导致子账户理论上可通过构造请求访问别的门店数据（调研结果已定位到多个接口）。

## 目标
- 子账户只管理“自己的子门店”：收银里的门店列表只显示授权门店；并且**任何后端接口**都不能通过传参绕过限制（读/写都要限制）。
- 其它模块同理：凡是门店维度的数据，都需要“后端强制校验 + 前端仅展示授权范围”。

## 实施方案（最小改动且可扩展）
### 1）建立统一的“门店权限校验”工具方法
- 新增一个统一方法（放在 `DepotService` 或 `CashierSessionService` 中复用）：
  - `ensureDepotPermission(depotId)`：已存在同等逻辑（见 [CashierSessionService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierSessionService.java#L251-L265)），把它抽成可复用的 public 方法或迁移到 `DepotService`。
  - 再新增：`ensureSessionPermission(sessionId)`（查 session → 取 depotId → 调 `ensureDepotPermission`）。
  - 再新增：`ensureServiceOrderPermission(orderId)`、`ensureCartItemPermission(itemId)`、`ensureCreditBillPermission(billId)`（都追溯到 session.depotId）。

### 2）在收银关键接口补齐“门店强校验”
按调研缺口逐个加校验：
- 座席：`GET /seat/list` 以及 seat 的增删改（现在仅靠传 depotId）：[SeatController.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/controller/SeatController.java#L30-L60)、[SeatService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/SeatService.java#L27-L33)
- 交班：`/cashier/shift/current|open|handover`（目前 depotId/shiftId 无门店校验）：[CashierShiftService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierShiftService.java#L30-L87)
- 购物车：`/cashier/cart/product/*`（sessionId/itemId 可越权）：[CashierCartService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierCartService.java#L25-L118)
- 服务下单：`/cashier/serviceOrder/*`（sessionId/orderId/itemId 可越权）：[ServiceOrderService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/cashier/ServiceOrderService.java#L36-L179)
- 结算：`/cashier/settlement/preview` 必须先校验 session 权限，避免金额泄露（checkout 也一起做）：[CashierSettlementService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CashierSettlementService.java#L28-L50)
- 挂账：`/cashier/credit/listOpen/create/settle/cancel` 需要按 session→depot 权限过滤/校验：
  - [CreditBillService.java](file:///Users/lv/Workspace/erp/jshERP-boot/src/main/java/com/jsh/erp/service/cashier/CreditBillService.java#L19-L52)

### 3）查询类接口要“默认按授权门店过滤”
- 不仅是校验入参 depotId 是否允许，还要对“按状态/按 tenant 查询”的接口补充 depot 过滤（例如 `credit/listOpen` 目前只按 tenant+status）。
- 实现方式：
  - 获取当前用户授权门店 id 集合（从 `UserDepot` 解析）
  - SQL 中追加 `depot_id in (...)` 或通过 join session 表过滤。

### 4）前端保持“只展示授权门店”，并在关键位置做防呆
- 收银门店下拉已使用 `/depot/findDepotByCurrentUser`，保持即可。
- 对前端可传 depotId 的调用（座席/交班）同步改为只从“授权门店列表”取值；即使被篡改，后端也会拦。

## 验证方式
- 新建子账户 test123，仅配置一个门店到 `UserDepot`：
  - UI：收银门店下拉只出现该门店
  - API：用浏览器/抓包篡改 depotId/sessionId/orderId，后端返回无权限/失败，不泄露数据
- 回归：管理员/租户本人仍可看到全部门店并正常收银。

我会先把收银链路补齐权限（上述列出的服务/接口），并加最小的回归验证用例（接口层），确保“菜单所有人可见”与“数据按门店隔离”同时成立。