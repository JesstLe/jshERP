## 现状结论（已核查）
- 底部栏按钮目前仅是静态按钮，没有 `@click`/跳转/后端调用，所以看起来“只是样子”。见 [Cashier.vue](file:///Users/lv/Workspace/erp/jshERP-web/src/views/cashier/Cashier.vue#L41-L53)。
- 行业化收银需要的“护理/预约/签单/交班/积分/礼品”等大多缺后端与表结构，需要补齐；座席与门店能力已具备。
- 你确认：
  - 技师数据 **复用** 现有 `jsh_person`（经手人表）
  - 需要 **提成**
  - 签单无审批，交班不强制拆分支付方式

## 目标
把底部栏从“入口占位”升级为：围绕座席的服务下单/结算/签单/交班的可用闭环（足浴修脚业务）。

## 分阶段方案
### 阶段 A：先让按钮全部“可用”，并形成最小闭环
目标：开台 → 选会员/散客 → 选技师/服务项目 → 结算（现金/扫码/签单）→ 清台。
- 顾客开卡：弹窗新增会员（复用 `jsh_supplier(type=会员)`），新增后自动选中。
- 顾客护理：弹窗“服务下单”（选技师、服务项目、数量/时长、备注），挂到当前座席会话。
- 签单清账：
  - 签单：结算时选择“签单挂账”，生成挂账记录。
  - 清账：从收银页入口打开“挂账列表”，选择挂账单后收款核销。
- 消费退货：先支持“本座席会话内撤销/退单”（最常用），后续再扩展为完整退货单据。
- 收银交班：提供“交班汇总弹窗”（本班次总额/挂账/退款/差额备注），不要求支付方式拆分。
- 预约/积分/礼品/兑换储值：阶段 A 可先隐藏或提示“开发中”（你要做时进入后续阶段）。

### 阶段 B：补齐后端+数据库（行业化收银域）
#### 1) 技师（复用经手人）
- 复用表：`jsh_person`（现有 DDL 见 [jsh_person](file:///Users/lv/Workspace/erp/jshERP-boot/docs/jsh_erp.sql#L639-L652)）。
- 约定：`type='技师'` 作为技师分类；收银页仅拉取 `enabled=1` 且 `type='技师'` 的人员列表。

#### 2) 新增核心表（建议最小集合）
1. **收银会话（开台/清台主单）**：`jsh_cashier_session`
   - `id, seat_id, depot_id, member_id(可空), status(OPEN/CLOSED/CANCELED), start_time, end_time, operator_user_id, tenant_id, remark`
2. **服务项目字典**：`jsh_service_item`
   - `id, name, price, duration_min(可空), enabled, sort, tenant_id, delete_flag`
3. **服务下单**：`jsh_service_order` + `jsh_service_order_item`
   - `service_order`: `id, session_id, technician_id(=jsh_person.id), status, created_time, tenant_id`
   - `service_order_item`: `id, service_order_id, service_item_id, qty, unit_price, amount, commission_amount, tenant_id`

#### 3) 提成设计（你确认“需要”）
为保证既灵活又好算账，采用“两层规则 + 结算时固化金额”：
- **规则表**：`jsh_commission_rule`
  - 字段建议：`id, rule_scope(SERVICE_ITEM/TECHNICIAN_ITEM/TECHNICIAN_ALL), technician_id(可空), service_item_id(可空), commission_type(PERCENT/FIXED), commission_value, enabled, tenant_id, delete_flag`
- **计算优先级**（从高到低）：
  1) 技师+项目专属规则（TECHNICIAN_ITEM）
  2) 项目默认规则（SERVICE_ITEM）
  3) 技师通用规则（TECHNICIAN_ALL）
  4) 默认 0
- **固化方式**：在 `service_order_item` 上落地 `commission_amount`（结算时写死），保证后续改规则不影响历史对账。

#### 4) 签单（无审批）与清账
- 新增表：`jsh_credit_bill`
  - `id, session_id, member_id(可空), amount, status(OPEN/SETTLED), created_time, settled_time, tenant_id`
- 清账：生成收款记录（可复用现有财务表，或先做收银域内收款表；优先复用）。

#### 5) 交班（不拆分）
- 新增表：`jsh_cashier_shift`
  - `id, depot_id, cashier_user_id, start_time, end_time, opening_amount, closing_amount, total_amount, diff_amount, remark, tenant_id`
- 汇总口径：按班次时间窗口聚合本班次所有“已结算金额/退款/挂账/清账”。界面只展示总数，不强制按支付方式拆。

#### 6) 后端 API（新增）
- Session：`/cashier/session/open|close|getCurrent|bindMember|switchSeat`
- Technician：复用人员接口（只增加“技师筛选”参数或新增 `/person/technicianList`）
- ServiceItem：`/cashier/serviceItem/list|add|update|delete`
- ServiceOrder：`/cashier/serviceOrder/add|removeItem|finish|listBySession`
- Commission：`/cashier/commissionRule/list|add|update|delete`
- Credit：`/cashier/credit/create|list|settle|cancel`
- Shift：`/cashier/shift/open|getCurrent|handover|summary`

## 前端落地（收银页为中心）
- 底部栏按钮改为打开对应弹窗/抽屉，并以“当前 session”为上下文。
- 新增弹窗：会员开卡、服务下单、签单/清账、交班汇总。
- 技师选择：来自 `jsh_person(type=技师)`。

## 交付顺序
1) 先补齐底部按钮交互（不再只是样子）。
2) 上线 `cashier_session + service_order + service_item`，实现护理下单与座席驱动。
3) 加入提成规则与结算固化。
4) 加入签单/清账与交班。
5) 预约/积分/礼品/兑换储值按你后续优先级继续扩展。

## 不再需要确认的点
- 技师：确定复用 `jsh_person`
- 提成：确定需要
- 签单：无审批
- 交班：不拆分支付方式（但后续可扩展，不影响当前口径）